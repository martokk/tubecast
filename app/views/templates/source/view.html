{% extends "base/base.html" %}

{% block title %}View Source{% endblock %}

{% block content_header %}{{ source.title }}{% endblock %}

{% block content %}
<div class="container my-5">
    <div>
        <div class="row justify-content-between align-items-center">
            <h4 class="col-auto">
                <a href="{{ source.url }}" class="text-decoration-none text-white">
                    {{ source.name }}
                    <span class="small mx-1"> <i class="fas fa-external-link-alt fa-sm small"></i>
                    </span>
                </a>
            </h4>
            <div class="col-auto small p-1">
                <a href="/source/{{ source.id }}/edit" class="text-decoration-none  text-muted me-3"><i
                        class="fas fa-pencil-alt me-2"></i>Edit</a>
                <a href="/filter/create?source={{ source.id }}" class="text-decoration-none text-muted me-3"><i
                        class="fas fa-plus-circle me-2"></i>Filter</a>
                <a href="/feed/{{ source.id }}" class="text-decoration-none text-muted me-3"><i
                        class="fas fa-rss me-2"></i>Feed</a>
                <a href="pktc://subscribe/{{ BASE_DOMAIN }}{{ source.feed_url }}"
                    class="text-decoration-none text-muted me-3"><i class="fas fa-plus-circle me-2"></i>PocketCast</a>
                {% if current_user.is_superuser %}
                <a href="/source/{{ source.id }}/fetch" class="text-decoration-none text-muted me-3"><i
                        class="fas fa-arrow-circle-right me-2"></i>Fetch</a>
                {% endif %}
                <a href="#" class="text-decoration-none text-muted me-3"
                    onclick="confirmDelete('/source/{{ source.id }}/delete', '{{ source.name }}')"><i
                        class="fas fa-trash me-2"></i>
                    Delete</a>
            </div>
        </div>

        <div class="row">
            <div class="col-auto">
                <div class="image-container">
                    <img src="{{ source.logo }}" class="cropped-image" width="150" height="150">
                </div>
            </div>

            <div class="col">
                <div class="row">
                    <div class="col-4 small">
                        <span class="badge small {{ source.service | service_badge_color}}">{{ source.service }}</span>
                    </div>
                </div>

                <div class="row">
                    <div class="col-12 mt-1">{{ source.description | safe }}</div>
                </div>

                <div class="row mt-3">
                    <div class="col small text-muted">
                        <em>Source ({{ source.id }}) created by {{ source.created_user.username }}.</em>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>




<div class="container">
    {% for video in source.videos_sorted()[0:30] %}
    <div class="row border-top py-1">



        <div class="d-flex align-items-top">
            <div class="me-3 d-flex align-items-center">
                <img src="{{ video.thumbnail }}" class="cropped-image" alt="" height="90" width="125">
            </div>
            <div class="col">
                <div class="col-12 small text-muted fw-bold">{{ video.released_at.strftime('%d %b %Y') | upper }}
                    <small><em>({{ video.released_at | humanize }})</em></small>
                </div>
                <h5 class="mb-0"><a href="/video/{{ video.id }}{% if source %}?source_id={{ source.id }}{% endif %}"
                        class="text-decoration-none text-white">{{ video.title }}</a></h5>
                {% if not video.media_url %}
                <div class="small text-danger fw-bold">No media URL available</div>
                {% endif %}
                <div class="">
                    {% if video.duration %}
                    <div class="small">{{ (video.duration / 60) | int }} minutes.</div>
                    {% endif %}
                </div>
                {% if current_user.is_superuser %}
                <div class="text-end small ms-auto">
                    {% if video.handler == "YoutubeHandler" %}
                    <div class="{{ video.updated_at | humanize_color_class_youtube }} small ms-auto">
                        {% elif video.handler == "RumbleHandler" %}
                        <div class="{{ video.updated_at | humanize_color_class_rumble }} small ms-auto">
                            {% else %}
                            <div class="{{ video.updated_at | humanize_color_class_youtube }} small ms-auto">
                                {% endif %}
                                <em>Updated: {{ video.updated_at | humanize }}</em>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            {% endfor %}
        </div>







        <script>
            function confirmDelete(url, source_name) {
                if (confirm("Are you sure you want to delete '" + source_name + "' source?")) {
                    window.location.href = url;
                }
            }
        </script>



        {% endblock content %}
